<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vintage Guitar Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f1117;
            color: #e2e4e9;
            padding: 1rem;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header {
            padding: 1.5rem 0;
            border-bottom: 1px solid #1e2028;
            margin-bottom: 2rem;
        }
        h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 0.5rem;
        }
        .subtitle { color: #6b7080; font-size: 0.9rem; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: #16181f;
            border: 1px solid #1e2028;
            border-radius: 8px;
            padding: 1.25rem;
        }
        .stat-label {
            font-size: 0.75rem;
            color: #6b7080;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #fff;
        }
        .stat-value.currency::before {
            content: '$';
            font-size: 1.2rem;
            color: #818cf8;
        }
        /* Editable budget card */
        .budget-card { cursor: pointer; transition: background 0.2s, border-color 0.2s; position: relative; }
        .budget-card:hover { background: #1a1c23; border-color: #818cf8; }
        .budget-card .edit-icon { position: absolute; top: 0.75rem; right: 0.75rem; font-size: 0.8rem; color: #6b7080; }
        .budget-card:hover .edit-icon { color: #818cf8; }
        .budget-edit { display: none; }
        .budget-card.editing .budget-display { display: none; }
        .budget-card.editing .budget-edit { display: block; }
        .budget-card.editing { cursor: default; }
        .budget-card.editing:hover { background: #16181f; border-color: #1e2028; }
        .budget-row { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem; }
        .budget-row label { font-size: 0.75rem; color: #6b7080; width: 50px; text-transform: uppercase; }
        .budget-btn { background: #1e2028; border: 1px solid #2a2d38; color: #e2e4e9; width: 28px; height: 28px; border-radius: 4px; cursor: pointer; font-size: 1rem; display: flex; align-items: center; justify-content: center; }
        .budget-btn:hover { background: #2a2d38; border-color: #818cf8; }
        .budget-amount { font-size: 1rem; font-weight: 600; color: #fff; min-width: 80px; text-align: center; }
        .budget-actions { display: flex; gap: 0.5rem; margin-top: 0.25rem; }
        .budget-actions button { padding: 0.35rem 0.75rem; border-radius: 4px; border: none; font-size: 0.75rem; font-weight: 600; cursor: pointer; }
        .btn-save { background: #818cf8; color: #fff; }
        .btn-save:hover { background: #6366f1; }
        .btn-cancel { background: #1e2028; color: #6b7080; }
        .btn-cancel:hover { background: #2a2d38; color: #e2e4e9; }
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #1e2028;
            overflow-x: auto;
        }
        .tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            color: #6b7080;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .tab:hover {
            color: #e2e4e9;
        }
        .tab.active {
            color: #818cf8;
            border-bottom-color: #818cf8;
        }
        .table-container {
            background: #16181f;
            border: 1px solid #1e2028;
            border-radius: 8px;
            overflow-x: auto;
            display: none;
        }
        .table-container.active { display: block; }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th {
            background: #1a1c23;
            padding: 1rem;
            text-align: left;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #8b8fa3;
            border-bottom: 1px solid #1e2028;
            white-space: nowrap;
        }
        td {
            padding: 1rem;
            border-bottom: 1px solid #1e2028;
            font-size: 0.85rem;
            color: #e2e4e9;
        }
        tr:last-child td { border-bottom: none; }
        tr:hover { background: #1a1c23; }
        .score-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.85rem;
        }
        .score-high {
            background: rgba(34, 197, 94, 0.15);
            color: #4ade80;
        }
        .score-medium {
            background: rgba(250, 204, 21, 0.15);
            color: #facc15;
        }
        .score-low {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
        }
        .link { color: #818cf8; text-decoration: none; cursor: pointer; }
        .link:hover { text-decoration: underline; color: #a5b4fc; }
        .empty-state {
            padding: 4rem 2rem;
            text-align: center;
            color: #6b7080;
        }
        .loading {
            padding: 4rem 2rem;
            text-align: center;
            color: #6b7080;
        }
        @media (max-width: 768px) {
            h1 { font-size: 1.5rem; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .stat-value { font-size: 1.5rem; }
            th, td {
                padding: 0.75rem 0.5rem;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé∏ Vintage Guitar Dashboard</h1>
            <p class="subtitle">Real-time view of listings, recommendations & collection</p>
        </header>

        <div class="stats-grid" id="stats">
            <div class="stat-card">
                <div class="stat-label">Active Listings</div>
                <div class="stat-value" id="active-listings">‚Äî</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Top Recommendations</div>
                <div class="stat-value" id="recommendations">‚Äî</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Collection Size</div>
                <div class="stat-value" id="collection-size">‚Äî</div>
            </div>
            <div class="stat-card budget-card" id="budget-card" onclick="toggleBudgetEdit(event)">
                <span class="edit-icon">&#9998;</span>
                <div class="budget-display">
                    <div class="stat-label">Budget Remaining</div>
                    <div class="stat-value currency" id="budget-remaining">‚Äî</div>
                </div>
                <div class="budget-edit">
                    <div class="stat-label" style="margin-bottom: 0.75rem;">Edit Budget</div>
                    <div class="budget-row">
                        <label>Total</label>
                        <button class="budget-btn" onclick="adjustBudget('total', -500, event)">-</button>
                        <div class="budget-amount" id="edit-total">$20,000</div>
                        <button class="budget-btn" onclick="adjustBudget('total', 500, event)">+</button>
                    </div>
                    <div class="budget-row">
                        <label>Spent</label>
                        <button class="budget-btn" onclick="adjustBudget('spent', -100, event)">-</button>
                        <div class="budget-amount" id="edit-spent">$0</div>
                        <button class="budget-btn" onclick="adjustBudget('spent', 100, event)">+</button>
                    </div>
                    <div class="budget-actions">
                        <button class="btn-save" onclick="saveBudget(event)">Save</button>
                        <button class="btn-cancel" onclick="cancelBudgetEdit(event)">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('recommendations', this)">Top Recommendations</button>
            <button class="tab" onclick="switchTab('listings', this)">All Listings</button>
            <button class="tab" onclick="switchTab('collection', this)">My Collection</button>
        </div>

        <div id="recommendations-table" class="table-container active">
            <div class="loading">Loading recommendations...</div>
        </div>

        <div id="listings-table" class="table-container">
            <div class="loading">Loading listings...</div>
        </div>

        <div id="collection-table" class="table-container">
            <div class="loading">Loading collection...</div>
        </div>

        <!-- Workflow Diagram -->
        <div style="margin-top: 4rem; padding: 3rem 2rem; background: #16181f; border-top: 2px solid #1e2028;">
            <h2 style="text-align: center; color: #fff; margin-bottom: 0.75rem; font-size: 1.8rem;">üîÑ Agentic Workflow Pipeline</h2>
            <p style="text-align: center; color: #6b7080; margin-bottom: 3rem;">Real-time view of autonomous agents processing vintage guitar data</p>

            <div class="flow-layer" style="margin-bottom: 3rem;">
                <div style="font-size: 0.75rem; color: #6b7080; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 1rem;">1. Input Sources</div>
                <div style="display: flex; gap: 1.5rem; flex-wrap: wrap;">
                    <div style="background: #1a1c23; border: 2px solid #818cf8; border-radius: 12px; padding: 1.5rem; min-width: 180px;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üåê</div>
                        <div style="font-weight: 600; color: #fff; margin-bottom: 0.25rem;">Retrofret.com</div>
                        <div style="font-size: 0.8rem; color: #6b7080;">Vintage guitars</div>
                    </div>
                    <div style="background: #1a1c23; border: 2px solid #818cf8; border-radius: 12px; padding: 1.5rem; min-width: 180px;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üåê</div>
                        <div style="font-weight: 600; color: #fff; margin-bottom: 0.25rem;">Woodstore.fr</div>
                        <div style="font-size: 0.8rem; color: #6b7080;">Paris dealer</div>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin: 2rem 0; color: #6b7080; font-size: 2rem;">‚Üì</div>

            <div class="flow-layer" style="margin-bottom: 3rem;">
                <div style="font-size: 0.75rem; color: #6b7080; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 1rem;">2. Autonomous Agents</div>
                <div style="display: flex; gap: 1.5rem; align-items: center; flex-wrap: wrap;">
                    <div style="background: #1a1c23; border: 2px solid #4ade80; border-radius: 12px; padding: 1.5rem; min-width: 180px; position: relative;">
                        <div style="position: absolute; top: 0.5rem; right: 0.5rem; width: 8px; height: 8px; border-radius: 50%; background: #4ade80; animation: pulse 2s infinite;"></div>
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üëÅÔ∏è</div>
                        <div style="font-weight: 600; color: #fff; margin-bottom: 0.25rem;">Watchdog</div>
                        <div style="font-size: 0.8rem; color: #6b7080;">watchdog.py ‚Ä¢ 24/7</div>
                    </div>
                    <div style="font-size: 2rem; color: #6b7080;">‚Üí</div>
                    <div style="background: #1a1c23; border: 2px solid #4ade80; border-radius: 12px; padding: 1.5rem; min-width: 180px; position: relative;">
                        <div style="position: absolute; top: 0.5rem; right: 0.5rem; width: 8px; height: 8px; border-radius: 50%; background: #4ade80; animation: pulse 2s infinite;"></div>
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üï∑Ô∏è</div>
                        <div style="font-weight: 600; color: #fff; margin-bottom: 0.25rem;">Scraper</div>
                        <div style="font-size: 0.8rem; color: #6b7080;">searcher.py ‚Ä¢ 5 min</div>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin: 2rem 0; color: #6b7080; font-size: 2rem;">‚Üì</div>

            <div class="flow-layer" style="margin-bottom: 3rem;">
                <div style="font-size: 0.75rem; color: #6b7080; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 1rem;">3. Data Storage</div>
                <div style="display: flex; gap: 1.5rem; flex-wrap: wrap;">
                    <div style="background: #1a1c23; border: 2px solid #facc15; border-radius: 12px; padding: 1.5rem; min-width: 180px;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìä</div>
                        <div style="font-weight: 600; color: #fff; margin-bottom: 0.25rem;">listings.xlsx</div>
                        <div style="font-size: 0.8rem; color: #6b7080;"><span id="workflow-listings-count">419</span> guitars tracked</div>
                    </div>
                    <div style="background: #1a1c23; border: 2px solid #facc15; border-radius: 12px; padding: 1.5rem; min-width: 180px;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìã</div>
                        <div style="font-weight: 600; color: #fff; margin-bottom: 0.25rem;">JSON Cache</div>
                        <div style="font-size: 0.8rem; color: #6b7080;">State & history</div>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin: 2rem 0; color: #6b7080; font-size: 2rem;">‚Üì</div>

            <div class="flow-layer" style="margin-bottom: 3rem;">
                <div style="font-size: 0.75rem; color: #6b7080; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 1rem;">4. Processing Pipeline</div>
                <div style="display: flex; gap: 1.5rem; align-items: center; flex-wrap: wrap;">
                    <div style="background: #1a1c23; border: 2px solid #c084fc; border-radius: 12px; padding: 1.5rem; min-width: 180px;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üí∞</div>
                        <div style="font-weight: 600; color: #fff; margin-bottom: 0.25rem;">Valuation</div>
                        <div style="font-size: 0.8rem; color: #6b7080;">valuation.py ‚Ä¢ Reverb API</div>
                    </div>
                    <div style="font-size: 2rem; color: #6b7080;">‚Üí</div>
                    <a href="pages/scorer.html" style="text-decoration: none; color: inherit;">
                    <div style="background: #1a1c23; border: 2px solid #c084fc; border-radius: 12px; padding: 1.5rem; min-width: 180px; cursor: pointer; transition: background 0.2s, border-color 0.2s;" onmouseover="this.style.background='#22243a';this.style.borderColor='#818cf8'" onmouseout="this.style.background='#1a1c23';this.style.borderColor='#c084fc'">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üéØ</div>
                        <div style="font-weight: 600; color: #fff; margin-bottom: 0.25rem;">Scorer</div>
                        <div style="font-size: 0.8rem; color: #6b7080;">scorer.py ‚Ä¢ ML ranking</div>
                    </div>
                    </a>
                </div>
            </div>

            <div style="text-align: center; margin: 2rem 0; color: #6b7080; font-size: 2rem;">‚Üì</div>

            <div class="flow-layer">
                <div style="font-size: 0.75rem; color: #6b7080; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 1rem;">5. Outputs & Actions</div>
                <div style="display: flex; gap: 1.5rem; flex-wrap: wrap;">
                    <div style="background: #1a1c23; border: 2px solid #f87171; border-radius: 12px; padding: 1.5rem; min-width: 180px;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚≠ê</div>
                        <div style="font-weight: 600; color: #fff; margin-bottom: 0.25rem;">Recommendations</div>
                        <div style="font-size: 0.8rem; color: #6b7080;">Top <span id="workflow-recs-count">10</span> picks</div>
                    </div>
                    <div style="background: #1a1c23; border: 2px solid #f87171; border-radius: 12px; padding: 1.5rem; min-width: 180px;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üì±</div>
                        <div style="font-weight: 600; color: #fff; margin-bottom: 0.25rem;">Telegram</div>
                        <div style="font-size: 0.8rem; color: #6b7080;">messenger.py ‚Ä¢ Real-time</div>
                    </div>
                    <div style="background: #1a1c23; border: 2px solid #f87171; border-radius: 12px; padding: 1.5rem; min-width: 180px;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìß</div>
                        <div style="font-weight: 600; color: #fff; margin-bottom: 0.25rem;">Email</div>
                        <div style="font-size: 0.8rem; color: #6b7080;">Gmail alerts</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var data = {
            stats: null,
            recommendations: null,
            listings: null,
            collection: null
        };

        function switchTab(tab, element) {
            var tabs = document.querySelectorAll('.tab');
            var containers = document.querySelectorAll('.table-container');
            
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            for (var i = 0; i < containers.length; i++) {
                containers[i].classList.remove('active');
            }

            if (element) element.classList.add('active');
            document.getElementById(tab + '-table').classList.add('active');
        }

        function formatCurrency(value) {
            if (value == null || value === '') return '‚Äî';
            return '$' + Math.round(value).toLocaleString();
        }

        function scoreBadge(score) {
            if (score == null) return '‚Äî';
            var className = score >= 80 ? 'score-high' : score >= 60 ? 'score-medium' : 'score-low';
            return '<span class="score-badge ' + className + '">' + score + '</span>';
        }

        function truncate(text, length) {
            length = length || 30;
            if (!text) return '‚Äî';
            return text.length > length ? text.substring(0, length) + '...' : text;
        }

        function loadData() {
            Promise.all([
                fetch('/api/stats').then(function(r) { return r.json(); }),
                fetch('/api/recommendations').then(function(r) { return r.json(); }),
                fetch('/api/listings').then(function(r) { return r.json(); }),
                fetch('/api/collection').then(function(r) { return r.json(); })
            ]).then(function(results) {
                data.stats = results[0];
                data.recommendations = results[1];
                data.listings = results[2];
                data.collection = results[3];

                renderStats();
                renderRecommendations();
                renderListings();
                renderCollection();
            }).catch(function(error) {
                console.error('Error loading data:', error);
            });
        }

        function renderStats() {
            var s = data.stats;
            if (!s) return;

            document.getElementById('active-listings').textContent = s.active_listings;
            document.getElementById('recommendations').textContent = s.recommendations;
            document.getElementById('collection-size').textContent = s.collection_size;
            document.getElementById('budget-remaining').textContent = s.budget_remaining.toLocaleString();
        }

        function renderRecommendations() {
            var container = document.getElementById('recommendations-table');
            var items = data.recommendations;

            if (!items || items.length === 0) {
                container.innerHTML = '<div class="empty-state">No recommendations yet.</div>';
                return;
            }

            var html = '<table><thead><tr>' +
                '<th>Rank</th><th>Brand</th><th>Model</th><th>Year</th>' +
                '<th>Price</th><th>Score</th><th>Condition</th><th>Link</th>' +
                '</tr></thead><tbody>';

            for (var i = 0; i < items.length; i++) {
                var item = items[i];
                html += '<tr>' +
                    '<td>' + (item.Rank || '‚Äî') + '</td>' +
                    '<td>' + (item.Brand || '‚Äî') + '</td>' +
                    '<td>' + truncate(item.Model, 25) + '</td>' +
                    '<td>' + (item.Year || '‚Äî') + '</td>' +
                    '<td>' + formatCurrency(item['Price ($)']) + '</td>' +
                    '<td>' + scoreBadge(item.Score) + '</td>' +
                    '<td>' + (item.Condition || '‚Äî') + '</td>' +
                    '<td><a href="' + item.URL + '" target="_blank" class="link">View</a></td>' +
                    '</tr>';
            }

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function renderListings() {
            var container = document.getElementById('listings-table');
            var items = data.listings;

            if (!items || items.length === 0) {
                container.innerHTML = '<div class="empty-state">No listings found.</div>';
                return;
            }

            var html = '<table><thead><tr>' +
                '<th>ID</th><th>Brand</th><th>Model</th><th>Type</th><th>Year</th>' +
                '<th>Price</th><th>Condition</th><th>Status</th><th>Link</th>' +
                '</tr></thead><tbody>';

            for (var i = 0; i < items.length; i++) {
                var item = items[i];
                var status = item.Sold ? '‚ùå Sold' : item['On Hold'] ? '‚è∏Ô∏è Hold' : '‚úÖ Active';
                html += '<tr>' +
                    '<td>' + (item.ID || '‚Äî') + '</td>' +
                    '<td>' + (item.Brand || '‚Äî') + '</td>' +
                    '<td>' + truncate(item.Model, 25) + '</td>' +
                    '<td>' + (item.Type || '‚Äî') + '</td>' +
                    '<td>' + (item.Year || '‚Äî') + '</td>' +
                    '<td>' + formatCurrency(item.Price) + '</td>' +
                    '<td>' + (item.Condition || '‚Äî') + '</td>' +
                    '<td>' + status + '</td>' +
                    '<td><a href="' + item.URL + '" target="_blank" class="link">View</a></td>' +
                    '</tr>';
            }

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function renderCollection() {
            var container = document.getElementById('collection-table');
            var items = data.collection;

            if (!items || items.length === 0) {
                container.innerHTML = '<div class="empty-state">No guitars in collection yet.</div>';
                return;
            }

            var html = '<table><thead><tr>' +
                '<th>Brand</th><th>Model</th><th>Year</th><th>Type</th>' +
                '<th>Condition</th><th>Current Value</th><th>Value in 1Y</th><th>Acquired</th>' +
                '</tr></thead><tbody>';

            for (var i = 0; i < items.length; i++) {
                var item = items[i];
                html += '<tr>' +
                    '<td>' + (item.brand || '‚Äî') + '</td>' +
                    '<td>' + truncate(item.model, 25) + '</td>' +
                    '<td>' + (item.year || '‚Äî') + '</td>' +
                    '<td>' + (item.type || '‚Äî') + '</td>' +
                    '<td>' + (item.condition || '‚Äî') + '</td>' +
                    '<td>' + formatCurrency(item.current_value) + '</td>' +
                    '<td>' + formatCurrency(item.value_1y) + '</td>' +
                    '<td>' + (item.acquired_date || '‚Äî') + '</td>' +
                    '</tr>';
            }

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        /* ‚îÄ‚îÄ Budget editing ‚îÄ‚îÄ */
        var budgetEditState = { total: 0, spent: 0 };

        function toggleBudgetEdit(e) {
            var card = document.getElementById('budget-card');
            if (card.classList.contains('editing')) return;
            // Initialize edit values from current stats
            budgetEditState.total = data.stats ? data.stats.budget_total : 0;
            budgetEditState.spent = data.stats ? data.stats.budget_spent : 0;
            renderBudgetEdit();
            card.classList.add('editing');
        }

        function adjustBudget(field, delta, e) {
            e.stopPropagation();
            budgetEditState[field] = Math.max(0, budgetEditState[field] + delta);
            // Keep spent <= total
            if (budgetEditState.spent > budgetEditState.total) {
                budgetEditState.spent = budgetEditState.total;
            }
            renderBudgetEdit();
        }

        function renderBudgetEdit() {
            document.getElementById('edit-total').textContent = '$' + budgetEditState.total.toLocaleString();
            document.getElementById('edit-spent').textContent = '$' + budgetEditState.spent.toLocaleString();
        }

        function saveBudget(e) {
            e.stopPropagation();
            fetch('/api/budget', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ total: budgetEditState.total, spent: budgetEditState.spent })
            })
            .then(function(r) {
                if (!r.ok) throw new Error('Save failed');
                return r.json();
            })
            .then(function() {
                document.getElementById('budget-card').classList.remove('editing');
                loadData();
            })
            .catch(function(err) {
                console.error('Budget save error:', err);
            });
        }

        function cancelBudgetEdit(e) {
            e.stopPropagation();
            document.getElementById('budget-card').classList.remove('editing');
        }

        loadData();
        setInterval(loadData, 30000);
    </script>
</body>
</html>
